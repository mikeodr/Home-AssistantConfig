- alias: Lights ON when sunsets -1 hr earlier and anyone home
  trigger:
     platform: sun
     event: sunset
     offset: "-01:00:00"
  condition:
     condition: state
     entity_id: group.all_devices
     state: 'home'
  action:
     service: light.turn_on
     entity_id:
         - light.living
         - switch.switch2

- alias: Lights OFF when bedtime work day
  trigger:
     platform: time
     at: '23:15:00'
  action:
     - service: homeassistant.turn_off
       entity_id:
           - group.all_lights
           - switch.switch2
  condition:
    - condition: time
      weekday:
        - sun
        - mon
        - tue
        - wed
        - thu

- alias: Lights OFF weekend bedtime
  trigger:
    platform: state
    entity_id: media_player.family_room_tv
    to: 'unavailable'
  condition:
    - condition: time
      after: '23:00:00'
      before: '03:00:00'
      weekday:
        - fri
        - sat
        - sun
  action:
    - service: homeassistant.turn_off
      entity_id:
        - group.all_lights
        - switch.front_hall
        - switch.kitchen_light
        - switch.switch2

- alias: OFF nobody home, no pupper
  trigger:
    platform: state
    entity_id: group.all_devices
    from: 'home'
    to: 'not_home'
  condition:
    - condition: state
      entity_id: input_boolean.pupper_home
      state: 'off'
  action:
    - service: homeassistant.turn_off
      entity_id:
        - group.all_lights
        - switch.switch1
        - switch.switch2
        - switch.switch3

- alias: OFF nobody home, pupper home
  trigger:
    platform: state
    entity_id: group.all_devices
    from: 'home'
    to: 'not_home'
  condition:
    - condition: state
      entity_id: input_boolean.pupper_home
      state: 'on'
  action:
    - service: homeassistant.turn_off
      entity_id:
        - light.front_hall
        - light.kitchen
        - light.right_bottom
        - light.tv_light
        - switch.switch1
        - switch.switch2
        - switch.switch3
    - service: homeassistant.turn_on
      entity_id:
        - light.right_top
        - light.left_top

- alias: Lights ON when arrival past sunset
  trigger:
    platform: state
    entity_id: group.all_devices
    from: 'not_home'
    to: 'home'
  condition:
    condition: or
    conditions:
      - condition: sun
        after: sunset
        after_offset: "-1:00:00"
      - condition: sun
        before: sunrise
  action:
      service: homeassistant.turn_on
      entity_id:
        - group.all_lights
        - switch.front_hall
        - switch.kitchen_light
        - switch.switch2

- alias: Presence Notifications Home
  trigger:
     platform: state
     entity_id: device_tracker.tiffs_phone
     from: 'not_home'
     to: 'home'
  action:
     service: notify.notify
     data_template:
       title: "HASS Presence Notification"
       message: >
         {{ trigger.to_state.attributes.friendly_name }} is {% if trigger.to_state.state == 'home' %}back{% else %}away{% endif %}.

- alias: Presence Notifications Away
  trigger:
     platform: state
     entity_id: device_tracker.tiffs_phone
     from: 'home'
     to: 'not_home'
  action:
     service: notify.notify
     data_template:
       title: "HASS Presence Notification"
       message: >
         {{ trigger.to_state.attributes.friendly_name }} is {% if trigger.to_state.state == 'home' %}back{% else %}away{% endif %}.

- alias: Bedroom Comfort when arrival past bedtime
  trigger:
    platform: state
    entity_id: group.all_devices
    from: 'not_home'
    to: 'home'
  condition:
    - condition: time
      after: '23:00:00'
      before: '05:00:00'
  action:
     service: homeassistant.turn_on
     entity_id:
       - switch.switch3

#- alias: Kitchen Fan off overnight
  #trigger:
    #platform: time
    #at: '00:00:00'
  #action:
    #service: homeassistant.turn_off
    #entity_id:
      #- switch.switch2

#- alias: Kitchen Fan Cooling
  #trigger:
      #- platform: state
        #entity_id: group.all_devices
        #from: 'not_home'
        #to: 'home'
      #- platform: time
        #at: '09:01:00'
  #condition:
    #condition: and
    #conditions:
      #- condition: time
        #after: '09:00:00'
        #before: '23:00:00'
      #- condition: state
        #entity_id: climate.kitchen_home
        #state: 'cool'
      #- condition: state
        #entity_id: group.all_devices
        #state: 'home'
  #action:
     #service: homeassistant.turn_on
     #entity_id:
       #- switch.switch2

- alias: Space Heater On Evening and Morning Work Days
  trigger:
    - platform: time
      at: '22:00:00'
    - platform: time
      at: '07:00:00'
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: group.all_devices
        state: 'home'
      - condition: numeric_state
        entity_id: sensor.dark_sky_temperature
        below: 8
      - condition: time
        weekday:
          - mon
          - tue
          - wed
          - thu
          - fri
  action:
    service: homeassistant.turn_on
    entity_id: switch.switch1

- alias: Space Heater OFF Evening and Morning
  trigger:
    - platform: time
      at: '23:00:00'
    - platform: time
      at: '08:10:00'
  action:
    service: homeassistant.turn_off
    entity_id: switch.switch1

- alias: Bedroom Fan On Evenings
  trigger:
    - platform: time
      at: '23:00:00'
  condition:
    - condition: state
      entity_id: group.all_devices
      state: 'home'
  action:
    service: homeassistant.turn_on
    entity_id: switch.switch3

- alias: Fan Off Weekday Morning
  trigger:
    - platform: time
      at: '07:00:00'
  condition:
    - condition: time
      weekday:
        - mon
        - tue
        - wed
        - thu
        - fri
  action:
    service: homeassistant.turn_off
    entity_id: switch.switch3

- alias: Fan Off Weekend Morning
  trigger:
    - platform: time
      at: '09:30:00'
  condition:
    - condition: time
      weekday:
        - sat
        - sun
  action:
    service: homeassistant.turn_off
    entity_id: switch.switch3

#- alias: Dehumidifier On Off Peak
  #trigger:
    #- platform: time
      #at: '23:00:00'
  #action:
    #service: homeassistant.turn_on
    #entity_id: switch.switch4

#- alias: Dehumidifier Off On Peak
  #trigger:
    #- platform: time
      #at: '07:00:00'
  #action:
    #service: homeassistant.turn_off
    #entity_id: switch.switch4

- alias: Ask if Pupper Home after Dark
  trigger:
    platform: sun
    event: sunset
    offset: "-01:00:00"
  condition:
    - condition: state
      entity_id: group.all_devices
      state: 'not_home'
  action:
    service: notify.notify
    data:
      message: "Is the puppy home alone?"
      data:
        actions:
          - action: "pupper_dark_yes"
            title: "Yes"
          - action: "pupper_dark_no"
            title: "No"

- alias: Pupper Question Event yes
  trigger:
    platform: event
    event_type: html5_notification.clicked
    event_data:
      action: pupper_dark_yes
  action:
    service: input_boolean.turn_on
    entity_id: input_boolean.pupper_home

- alias: Pupper Question Event No
  trigger:
    platform: event
    event_type: html5_notification.clicked
    event_data:
      action: pupper_dark_no
  action:
    service: input_boolean.turn_off
    entity_id: input_boolean.pupper_home

- alias: Pupper Lights On
  trigger:
    platform: sun
    event: sunset
  condition:
    - condition: state
      entity_id: input_boolean.pupper_home
      state: 'on'
  action:
    - service: homeassistant.turn_on
      entity_id:
        - light.left_top
        - light.right_top

- alias: Christmas Tree on evenings
  trigger:
    platform: time
    at: '18:00:00'
  condition:
    condition: state
    entity_id: group.all_devices
    state: 'home'
  action:
    service: homeassistant.turn_on
    entity_id:
      - switch.switch2

- alias: Outdoor Christmas Lights on
  trigger:
     platform: sun
     event: sunset
  action:
      service: homeassistant.turn_on
      entity_id:
        - switch.switch4

- alias: Outdoor Christmas Lights off
  trigger:
      platform: time
      at: '22:45:00'
  action:
      service: homeassistant.turn_off
      entity_id:
        - switch.switch4
